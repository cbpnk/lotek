@require(EDITOR, EDITOR_URL, PLUGINS)
<!doctype html>
<html>
<head>
<title></title>
<script src="/static/vendor/npm/mithril@@2.0.4/mithril.js"></script>
<script src="/static/vendor/npm/htm@@3.1.0/dist/htm.js"></script>
<link rel="stylesheet" href="/static/vendor/npm/spectre.css@@0.5.9/dist/spectre.min.css">
<link rel="stylesheet" href="/static/vendor/npm/spectre.css@@0.5.9/dist/spectre-exp.min.css">
<link rel="stylesheet" href="/static/vendor/npm/spectre.css@@0.5.9/dist/spectre-icons.min.css">
<link rel="stylesheet" href="/static/base.css">

<script type="text/javascript">
const EDITOR_URL = "@EDITOR_URL";
const html = htm.bind(m);
const registry = {};
registry.registry = registry;
registry.onload = [];

window.addEventListener(
    'load',
    function() {
        (async function() {
            const plugins = [
                "/static/layout.js",
                "/static/view.js",
                "/static/changes.js",
                "/static/title.js",
                "/static/new.js",
                "/static/search.js",
                "/static/category.js",
                "/static/pdf.js",
@for p in PLUGINS:
                "/static/@{p}.js",
@end
                "/static/uncategorized.js",
                "/static/@{EDITOR}.js"
            ];

            for (const filename of plugins) {
                const plugin = await import(filename);
                for (let name in registry) {
                    if (registry[name] instanceof Array) {
                        registry[name].push(...(plugin[name] || []));
                    } else {
                        Object.assign(registry[name], plugin[name] || {});
                    }
                }
            }

            for (const f of registry.onload) {
                f();
            }
        })();
    }
);
</script>
</head>
<body>
</body>
</html>
